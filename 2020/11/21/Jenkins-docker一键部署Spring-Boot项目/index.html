<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Jenkins+docker一键部署Spring Boot项目 | Pang-Blog</title><meta name="description" content="Jenkins+docker一键部署Spring Boot项目"><meta name="keywords" content="Spring Boot,Jenkins,Docker"><meta name="author" content="小胖儿"><meta name="copyright" content="小胖儿"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Jenkins+docker一键部署Spring Boot项目"><meta name="twitter:description" content="Jenkins+docker一键部署Spring Boot项目"><meta name="twitter:image" content="https://pangyuworld.github.io/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/timg"><meta property="og:type" content="article"><meta property="og:title" content="Jenkins+docker一键部署Spring Boot项目"><meta property="og:url" content="https://pangyuworld.github.io/2020/11/21/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/"><meta property="og:site_name" content="Pang-Blog"><meta property="og:description" content="Jenkins+docker一键部署Spring Boot项目"><meta property="og:image" content="https://pangyuworld.github.io/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/timg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '1'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://pangyuworld.github.io/2020/11/21/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/"><link rel="prev" title="劝你放弃纸上谈兵" href="https://pangyuworld.github.io/2021/03/30/%E5%8A%9D%E4%BD%A0%E6%94%BE%E5%BC%83%E7%BA%B8%E4%B8%8A%E8%B0%88%E5%85%B5/"><link rel="next" title="深入java基础（1）--安装java" href="https://pangyuworld.github.io/2020/11/13/%E6%B7%B1%E5%85%A5java%E5%9F%BA%E7%A1%80%EF%BC%881%EF%BC%89/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Pang-Blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">49</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">60</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#一、系统环境"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">一、系统环境</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#二、创建一个简单的Spring-Boot项目"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">二、创建一个简单的Spring Boot项目</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1、创建项目"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">1、创建项目</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2、打包项目"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">2、打包项目</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3、将该项目上传到GitHub"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">3、将该项目上传到GitHub</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#三、使用Jenkins自动部署Spring-Boot项目"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">三、使用Jenkins自动部署Spring Boot项目</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1、安装、运行Jenkins"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">1、安装、运行Jenkins</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2、配置环境"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">2、配置环境</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3、在Jenkins上新建项目"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">3、在Jenkins上新建项目</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4、编写自定义流水线"><span class="toc_mobile_items-number">3.4.</span> <span class="toc_mobile_items-text">4、编写自定义流水线</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#5、一键构建"><span class="toc_mobile_items-number">3.5.</span> <span class="toc_mobile_items-text">5、一键构建</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#四、配合Docker"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">四、配合Docker</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1、Docker将Spring-Boot项目打包成镜像"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">1、Docker将Spring Boot项目打包成镜像</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#新建Dockerfile"><span class="toc_mobile_items-number">4.1.1.</span> <span class="toc_mobile_items-text">新建Dockerfile</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#在本地构建镜像（测试用，可跳过）"><span class="toc_mobile_items-number">4.1.2.</span> <span class="toc_mobile_items-text">在本地构建镜像（测试用，可跳过）</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2、将Dockerfile上传到GitHub"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">2、将Dockerfile上传到GitHub</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3、修改pipeline脚本"><span class="toc_mobile_items-number">4.3.</span> <span class="toc_mobile_items-text">3、修改pipeline脚本</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#5、一键构建-1"><span class="toc_mobile_items-number">4.4.</span> <span class="toc_mobile_items-text">5、一键构建</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、系统环境"><span class="toc-number">1.</span> <span class="toc-text">一、系统环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、创建一个简单的Spring-Boot项目"><span class="toc-number">2.</span> <span class="toc-text">二、创建一个简单的Spring Boot项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、创建项目"><span class="toc-number">2.1.</span> <span class="toc-text">1、创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、打包项目"><span class="toc-number">2.2.</span> <span class="toc-text">2、打包项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、将该项目上传到GitHub"><span class="toc-number">2.3.</span> <span class="toc-text">3、将该项目上传到GitHub</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、使用Jenkins自动部署Spring-Boot项目"><span class="toc-number">3.</span> <span class="toc-text">三、使用Jenkins自动部署Spring Boot项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、安装、运行Jenkins"><span class="toc-number">3.1.</span> <span class="toc-text">1、安装、运行Jenkins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、配置环境"><span class="toc-number">3.2.</span> <span class="toc-text">2、配置环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、在Jenkins上新建项目"><span class="toc-number">3.3.</span> <span class="toc-text">3、在Jenkins上新建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4、编写自定义流水线"><span class="toc-number">3.4.</span> <span class="toc-text">4、编写自定义流水线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5、一键构建"><span class="toc-number">3.5.</span> <span class="toc-text">5、一键构建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四、配合Docker"><span class="toc-number">4.</span> <span class="toc-text">四、配合Docker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、Docker将Spring-Boot项目打包成镜像"><span class="toc-number">4.1.</span> <span class="toc-text">1、Docker将Spring Boot项目打包成镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#新建Dockerfile"><span class="toc-number">4.1.1.</span> <span class="toc-text">新建Dockerfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在本地构建镜像（测试用，可跳过）"><span class="toc-number">4.1.2.</span> <span class="toc-text">在本地构建镜像（测试用，可跳过）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、将Dockerfile上传到GitHub"><span class="toc-number">4.2.</span> <span class="toc-text">2、将Dockerfile上传到GitHub</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、修改pipeline脚本"><span class="toc-number">4.3.</span> <span class="toc-text">3、修改pipeline脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5、一键构建-1"><span class="toc-number">4.4.</span> <span class="toc-text">5、一键构建</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/timg)"><div id="post-info"><div id="post-title"><div class="posttitle">Jenkins+docker一键部署Spring Boot项目</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-11-21<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2021-06-29</time><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2020/11/21/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><h1 id="一、系统环境"><a href="#一、系统环境" class="headerlink" title="一、系统环境"></a>一、系统环境</h1><p>以下环境皆为必要系统环境；以下环境皆为我测试机的环境，实际操作不一定要如此高的版本</p>
<ul>
<li>Ubuntu 20.04LTS</li>
<li>Java 8</li>
<li>Maven 3.6.3</li>
<li>Docker 19.03.13</li>
<li>Jenkins 2.249.3</li>
<li>git 2.25.1</li>
</ul>
<h1 id="二、创建一个简单的Spring-Boot项目"><a href="#二、创建一个简单的Spring-Boot项目" class="headerlink" title="二、创建一个简单的Spring Boot项目"></a>二、创建一个简单的Spring Boot项目</h1><h2 id="1、创建项目"><a href="#1、创建项目" class="headerlink" title="1、创建项目"></a>1、创建项目</h2><p>使用IDEA等创建一个简单的Spring Boot项目，注意下面标红的几个点</p>
<p><a href="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/image-20201125105510326.png" data-fancybox="group" data-caption="image-20201125105510326" class="fancybox"><img alt="image-20201125105510326" title="image-20201125105510326" data-src="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/image-20201125105510326.png" class="lazyload"></a>)<a href="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/image-20201125105537719.png" data-fancybox="group" data-caption="image-20201125105537719" class="fancybox"><img alt="image-20201125105537719" title="image-20201125105537719" data-src="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/image-20201125105537719.png" class="lazyload"></a></p>
<p>然后创建一个类<code>Hello0Controller</code>，添加如下代码</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(String str)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello "</span>+str;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>此时，运行这个项目，访问<code>http://localhost:port/hello?str=world</code>以得到一串字符串<code>hello world</code>。以此来测试项目是否创建成功，是否运行成功。</p>
<h2 id="2、打包项目"><a href="#2、打包项目" class="headerlink" title="2、打包项目"></a>2、打包项目</h2><p>在 项目根目录处运行指令<code>mvn package</code>，对这个项目进行打包，正常情况下，项目会生成target文件夹，文件夹下的<code>xxx-0.0.1-SNAPSHOT.jar</code>即为打包生成的可执行jar包（xxx为项目的<code>artifactId</code>）</p>
<p>为了测试打包的jar包是否正确，我们可以使用指令执行该jar包，然后进行访问查看效果。执行指令如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">sh</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> targer/</span><br><span class="line">java -jar xxx-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></tbody></table></figure></div>

<p>访问<code>http://localhost:port/hello?str=world</code>以得到一串字符串<code>hello world</code>。以此来测试项目是否创建成功，是否运行成功。</p>
<h2 id="3、将该项目上传到GitHub"><a href="#3、将该项目上传到GitHub" class="headerlink" title="3、将该项目上传到GitHub"></a>3、将该项目上传到GitHub</h2><p>省略……</p>
<h1 id="三、使用Jenkins自动部署Spring-Boot项目"><a href="#三、使用Jenkins自动部署Spring-Boot项目" class="headerlink" title="三、使用Jenkins自动部署Spring Boot项目"></a>三、使用Jenkins自动部署Spring Boot项目</h1><p>我们先不使用Docker，直接用Jenkins部署这个SpringBoot项目。</p>
<p>先来统计一下，我们用到的指令如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">sh</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/xxx.git</span><br><span class="line"><span class="built_in">cd</span> xxx</span><br><span class="line">mvn package</span><br><span class="line"><span class="built_in">cd</span> target</span><br><span class="line">java -jar xxx-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></tbody></table></figure></div>

<p>如果我们自己在服务器终端，直接运行以上几个指令即可在服务器运行起我们的SpringBoot项目。Jenkins其实也只是将这些指令集成一下，做到一键即可部署。</p>
<h2 id="1、安装、运行Jenkins"><a href="#1、安装、运行Jenkins" class="headerlink" title="1、安装、运行Jenkins"></a>1、安装、运行Jenkins</h2><p>建议直接看文档进行安装：<a href="https://www.jenkins.io/zh" target="_blank" rel="noopener">Jenkins官网</a></p>
<p>安装完后运行时安装插件选择推荐插件即可，遇到的大部分Jenkins问题都可自行搜索解决。</p>
<h2 id="2、配置环境"><a href="#2、配置环境" class="headerlink" title="2、配置环境"></a>2、配置环境</h2><p>访问服务器运行的Jenkins主页，选择Manage Jenkins  -> Global Tool Configuration，进入到全局环境变量配置，将需要配置的环境（Java、Maven、Git）填入即可。</p>
<h2 id="3、在Jenkins上新建项目"><a href="#3、在Jenkins上新建项目" class="headerlink" title="3、在Jenkins上新建项目"></a>3、在Jenkins上新建项目</h2><p>访问服务器运行的Jenkins主页，选择“新建Item（New Item）”</p>
<p>然后输入该项目名称，并选择“流水线”后，点击确定新建项目</p>
<p><a href="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/image-20201125113416654.png" data-fancybox="group" data-caption="image-20201125113416654" class="fancybox"><img alt="image-20201125113416654" title="image-20201125113416654" data-src="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/image-20201125113416654.png" class="lazyload"></a></p>
<h2 id="4、编写自定义流水线"><a href="#4、编写自定义流水线" class="headerlink" title="4、编写自定义流水线"></a>4、编写自定义流水线</h2><p>点击确定按钮以后，跳转到配置页面，在配置页面，我们只用关心流水线脚本，其余配置若感兴趣可自行查阅其作用。</p>
<p><a href="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/image-20201125114310541.png" data-fancybox="group" data-caption="image-20201125114310541" class="fancybox"><img alt="image-20201125114310541" title="image-20201125114310541" data-src="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/image-20201125114310541.png" class="lazyload"></a></p>
<p>对于pipeline语法可以浏览官网进行学习，本篇文章所使用的都是简单的指令。本篇文章的脚本如下（注意根据自己的项目进行修改）</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">pipeline {</span><br><span class="line">    agent any</span><br><span class="line">    stages {</span><br><span class="line">        stage(<span class="string">'使用git下载代码'</span>) {</span><br><span class="line">            steps {</span><br><span class="line">                <span class="comment">// echo 可以用来做简单的输出</span></span><br><span class="line">                echo <span class="string">'git from github...'</span></span><br><span class="line">                <span class="comment">// 使用pipeline的git指令进行下载，如果分支是master，也可以使用 git 'https://github.com/xxx.git'</span></span><br><span class="line">                git <span class="string">url:</span> <span class="string">'https://github.com/xxx.git'</span>, <span class="string">branch:</span> <span class="string">'main'</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        stage(<span class="string">'使用Maven构建'</span>) {</span><br><span class="line">            steps {</span><br><span class="line">                echo <span class="string">"maven build start..."</span></span><br><span class="line">                <span class="comment">// 使用sh指令linux执行，Windows的话，可以使用bat</span></span><br><span class="line">                sh <span class="string">"mvn -Dmaven.test.skip=true clean package"</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        stage(<span class="string">'运行项目'</span>) {</span><br><span class="line">            steps {</span><br><span class="line">                echo <span class="string">"Spring boot start..."</span></span><br><span class="line">                sh <span class="string">"java -jar target/xxx-0.0.1-SNAPSHOT.jar"</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="5、一键构建"><a href="#5、一键构建" class="headerlink" title="5、一键构建"></a>5、一键构建</h2><p>进入到项目页面，点击按钮“Build Now”即可构建</p>
<p><a href="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/image-20201125150210237.png" data-fancybox="group" data-caption="image-20201125150210237" class="fancybox"><img alt="image-20201125150210237" title="image-20201125150210237" data-src="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/image-20201125150210237.png" class="lazyload"></a></p>
<p>下面是构建完成的截图</p>
<p><a href="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/image-20201125154325447.png" data-fancybox="group" data-caption="image-20201125154325447" class="fancybox"><img alt="image-20201125154325447" title="image-20201125154325447" data-src="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/image-20201125154325447.png" class="lazyload"></a></p>
<p>注意这里由于我们的指令问题，是不会构建完成，而是卡在运行项目这里，点击左下角<code>#12</code>左边的圆圈按钮即可查看输出信息</p>
<hr>
<p>到此，Jenkins配合Spring Boot实现自动化部署已经完成，每次上传完代码以后直接点击BuildNow按钮即可重新部署。但是，目前运行项目这个步骤一直无法完成，这个问题有两个解决办法：</p>
<ol>
<li>使用<code>nohup java -jar xxx.jar &</code>指令，但是如果使用这个指令需要用单引号包住这个指令且jar文件需要是绝对路径，感兴趣可以尝试一下。</li>
<li>使用Docker构建镜像并运行镜像</li>
</ol>
<h1 id="四、配合Docker"><a href="#四、配合Docker" class="headerlink" title="四、配合Docker"></a>四、配合Docker</h1><p>为了解决上述问题，我们引入Docker。引入Docker不光是为了解决上面那个问题，容器化已经是大势所趋，具体使用Docker有哪些好处可以自行搜索。</p>
<h2 id="1、Docker将Spring-Boot项目打包成镜像"><a href="#1、Docker将Spring-Boot项目打包成镜像" class="headerlink" title="1、Docker将Spring Boot项目打包成镜像"></a>1、Docker将Spring Boot项目打包成镜像</h2><p>Docker对Spring Boot项目打包的方式有很多种，这里我参考官方推荐的一种，参考网址：<a href="https://spring.io/guides/gs/spring-boot-docker/" target="_blank" rel="noopener">https://spring.io/guides/gs/spring-boot-docker/</a></p>
<h3 id="新建Dockerfile"><a href="#新建Dockerfile" class="headerlink" title="新建Dockerfile"></a>新建Dockerfile</h3><p>在项目根目录新建一个名为Dockerfile的文件，注意没有后缀名，其内容如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">dockerfile</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight dockerfile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /tmp</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> target/xxx-0.0.1-SNAPSHOT.jar app.jar</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"java"</span>,<span class="string">"-jar"</span>,<span class="string">"/app.jar"</span>]</span></span><br></pre></td></tr></tbody></table></figure></div>

<blockquote>
<p>Dockerfile 是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。</p>
<p><a href="https://www.runoob.com/docker/docker-dockerfile.html" target="_blank" rel="noopener">Dockerfile指令|菜鸟教程</a></p>
</blockquote>
<h3 id="在本地构建镜像（测试用，可跳过）"><a href="#在本地构建镜像（测试用，可跳过）" class="headerlink" title="在本地构建镜像（测试用，可跳过）"></a>在本地构建镜像（测试用，可跳过）</h3><p>如果你本地有Docker环境的话，可以在本地进行构建镜像。</p>
<p>在项目根目录运行指令<code>docker build -t spring-demo .</code>即可</p>
<p>运行该镜像的话，只用执行指令<code>docker run -d -p 8080:8080 spring-demo</code>即可，<code>8080:8080</code>指<strong>本地端口8080(第一个)映射到容器端口8080(第二个)</strong></p>
<h2 id="2、将Dockerfile上传到GitHub"><a href="#2、将Dockerfile上传到GitHub" class="headerlink" title="2、将Dockerfile上传到GitHub"></a>2、将Dockerfile上传到GitHub</h2><p>省略….</p>
<h2 id="3、修改pipeline脚本"><a href="#3、修改pipeline脚本" class="headerlink" title="3、修改pipeline脚本"></a>3、修改pipeline脚本</h2><p>修改后的脚本如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">pipeline {</span><br><span class="line">    agent any</span><br><span class="line">    stages {</span><br><span class="line">        stage(<span class="string">'停止旧容器'</span>) {</span><br><span class="line">            steps {</span><br><span class="line">                echo <span class="string">"stop if project is running..."</span></span><br><span class="line">                sh <span class="string">'docker ps -f name=spring-demo -q | xargs --no-run-if-empty docker container stop'</span></span><br><span class="line">                sh <span class="string">'docker ps -a -f name=spring-demo -q | xargs --no-run-if-empty docker container rm'</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        stage(<span class="string">'使用git下载代码'</span>) {</span><br><span class="line">            steps {</span><br><span class="line">                <span class="comment">// echo 可以用来做简单的输出</span></span><br><span class="line">                echo <span class="string">'git from github...'</span></span><br><span class="line">                <span class="comment">// 使用pipeline的git指令进行下载，如果分支是master，也可以使用 git 'https://github.com/xxx.git'</span></span><br><span class="line">                git <span class="string">url:</span> <span class="string">'https://github.com/xxx.git'</span>, <span class="string">branch:</span> <span class="string">'main'</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        stage(<span class="string">'使用Maven构建'</span>) {</span><br><span class="line">            steps {</span><br><span class="line">                echo <span class="string">"maven build start..."</span></span><br><span class="line">                <span class="comment">// 使用sh指令linux执行，Windows的话，可以使用bat</span></span><br><span class="line">                sh <span class="string">"mvn -Dmaven.test.skip=true clean package"</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        stage(<span class="string">'Docker构建'</span>) {</span><br><span class="line">            steps {</span><br><span class="line">                echo <span class="string">"docker build start..."</span></span><br><span class="line">                sh <span class="string">"docker build -t spring-demo ."</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        stage(<span class="string">'Docker运行'</span>) {</span><br><span class="line">            steps {</span><br><span class="line">                echo <span class="string">"docker image start..."</span></span><br><span class="line">                sh <span class="string">"docker run -d -p 8080:8080 --name spring-demo spring-demo"</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="5、一键构建-1"><a href="#5、一键构建-1" class="headerlink" title="5、一键构建"></a>5、一键构建</h2><p>先将没有集成Docker的那个构建停止，然后重新点击BuildNow即可</p>
<hr>
<p>以上，Jenkins+Docker+SpringBoot的自动部署就实现完成了，我的项目代码地址：<a href="https://github.com/pangyuworld/spring-demo" target="_blank" rel="noopener">https://github.com/pangyuworld/spring-demo</a> 仅供参考</p>
</body></html></div></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring-Boot/">Spring Boot    </a><a class="post-meta__tags" href="/tags/Jenkins/">Jenkins    </a><a class="post-meta__tags" href="/tags/Docker/">Docker    </a></div><div class="post_share"><div class="social-share" data-image="/assets/Jenkins-docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Spring-Boot%E9%A1%B9%E7%9B%AE/timg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.png" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2021/03/30/%E5%8A%9D%E4%BD%A0%E6%94%BE%E5%BC%83%E7%BA%B8%E4%B8%8A%E8%B0%88%E5%85%B5/"><img class="prev_cover lazyload" data-src="/assets/劝你放弃纸上谈兵/u=3055275310,1241112857&amp;fm=26&amp;gp=0.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>劝你放弃纸上谈兵</span></div></a></div><div class="next-post pull_right"><a href="/2020/11/13/%E6%B7%B1%E5%85%A5java%E5%9F%BA%E7%A1%80%EF%BC%881%EF%BC%89/"><img class="next_cover lazyload" data-src="/assets/深入java基础（1）/timg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>深入java基础（1）--安装java</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '29b42fd6892324c6f96e',
  clientSecret: '5057141e64d6998667ed7475126857372b8285b6',
  repo: 'pangyuworld.github.io',
  owner: 'pangyuworld',
  admin: 'pangyuworld',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
}</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By 小胖儿</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://xiaopangemm.coding.me/" target="_blank" rel="noopener">blog</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":250,"height":500},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>